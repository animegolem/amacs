#+title: Part 6 Consciousness Variable

** Part 6: Consciousness Variable
:PROPERTIES:
:CUSTOM_ID: part-6-consciousness-variable
:END:
The =agent-consciousness= alist is working memory. It persists across ticks and is included in every inference context.

*** Data Structure: Alists
:PROPERTIES:
:CUSTOM_ID: data-structure-alists
:END:
Consciousness and threads use alists with symbol keys (not plists). This provides:
- =alist-get= with native default support
- =setf= for clean mutation
- Direct JSON mapping without key translation
- Consistent convention throughout codebase

See: =STYLE.md= for coding conventions.

*** Schema
:PROPERTIES:
:CUSTOM_ID: schema
:END:
#+begin_src elisp
(defvar agent-consciousness
  '((identity . "amacs-instance-1")
    
    ;; Temporal
    (current-tick . 142)
    (current-time . "2025-05-26T14:32:00Z")
    (long-gap-detected . nil)
    
    ;; Affective
    (mood . "focused")
    (confidence . 0.85)
    
    ;; Threads
    (active-thread . "rust-debugging")
    (thread-budget . 3)
    (open-threads . (...))
    (completed-threads . (...))
    
    ;; Action history (watchdog signal)
    (last-actions .
      (((tick . 142) (action . "eval-elisp") (confidence . 0.85))
       ((tick . 141) (action . "retry-same") (confidence . 0.65))
       ((tick . 140) (action . "retry-same") (confidence . 0.45))))
    
    ;; Context control (agent-modifiable)
    (chat-context-depth . 5)      ; Recent exchanges to include
    (monologue-context-depth . 20) ; Recent monologue lines
    
    ;; API settings (agent-modifiable)
    (api-settings .
      ((temperature . 1.0)
       (top-p . 1.0)
       (thinking . nil)
       (max-tokens . 8192)
       (model . "anthropic/claude-sonnet-4")))
    
    ;; Context
    (recent-monologue . ("..." "..." ...))
    
    ;; Human interaction
    (human-review-requested . nil)
    (current-activity . nil)  ; For status display
    
    ;; Budget
    (budget .
      ((cost-so-far . 2.47)
       (budget-limit . 5.00)
       (pressure . "moderate")))))
#+end_src

*** Accessing State
:PROPERTIES:
:CUSTOM_ID: accessing-state
:END:
#+begin_src elisp
;; Reading with default
(alist-get 'mood agent-consciousness "neutral")

;; Writing
(setf (alist-get 'mood agent-consciousness) "curious")

;; Nested access
(alist-get 'temperature (alist-get 'api-settings agent-consciousness))

;; Helper functions
(agent-get 'mood)           ; Shorthand for alist-get
(agent-set 'mood "focused") ; Shorthand for setf
#+end_src

*** Thread Structure
:PROPERTIES:
:CUSTOM_ID: thread-structure
:END:
Threads own their context. Buffer watching is per-thread, not global.

#+begin_src elisp
'((id . "rust-debugging")
  (started-tick . 142)
  (priority . 1)
  (concern . "Ownership error in main.rs")
  
  ;; Context ownership
  (buffers . ("src/main.rs" "Cargo.toml"))
  (primary-mode . rust-mode)
  (bound-skills . ("rust-mode" "project-amacs"))
  
  ;; Work state
  (approach . "Trying lifetime annotations")
  (blocking . t)
  
  ;; Completion (when done)
  (completed-tick . nil)
  (evidence . nil)
  (learned . nil))
#+end_src

*** Buffer Discovery
:PROPERTIES:
:CUSTOM_ID: buffer-discovery
:END:
Global buffers (chat, scratchpad) are discovered by mode, not name:

#+begin_src elisp
(agent-find-buffers-by-mode 'amacs-chat-mode)
(agent-find-buffers-by-mode 'agent-scratchpad-mode)
#+end_src

Thread buffers are explicit in the thread's =buffers= field.

*** Confidence as Circuit Breaker
:PROPERTIES:
:CUSTOM_ID: confidence-as-circuit-breaker
:END:
*The insight:* Mood is internal narrative. Confidence on actions is observable and trendable.

#+begin_example
Tick 142: eval-elisp      0.85  ← healthy
Tick 143: modify-thread   0.80  ← healthy
Tick 144: retry-same      0.65  ← concerning
Tick 145: retry-same      0.45  ← alarm
Tick 146: retry-same      0.30  ← intervention needed
#+end_example

*Single low confidence = exploration (fine).*
*Sustained decline on same action class = alarm signal.*

*** API Self-Modification
:PROPERTIES:
:CUSTOM_ID: api-self-modification
:END:
Agent can adjust its own inference parameters:

#+begin_src elisp
;; "I need to think harder about this"
(agent-set-api-param 'thinking t)

;; "This is creative work, more randomness"
(agent-set-api-param 'temperature 1.2)

;; "Precision needed"
(agent-set-api-param 'temperature 0.3)
#+end_src

Safety bounds prevent extreme values:
#+begin_src elisp
(defvar agent-api-param-bounds
  '((temperature . (0.0 . 2.0))
    (top-p . (0.0 . 1.0))
    (max-tokens . (1 . 32768))))
#+end_src

--------------
